{% extends "dashboard.html" %}

{% block content %}



<div class="card p-2">
  <div class="d-flex flex-row justify-content-between align-items-center">
    <div class="m-2 fw-bold fs-4">{{type}}s</div>
    <span><button class="btn btn-primary" data-bs-target="#addItem" data-bs-toggle="modal">add new </button></span>
  </div>
  <div class="m-2 fw-bold fs-4"> </div>
  <!-- add item modal -->
  <div class="modal fade" id="addItem" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
      <div class=" modal-content">
        <div class="modal-header border-0 fw-bold"> Add Item Card </div>
        <form action="" method="post" enctype="multipart/form-data">
          <div class="modal-body">
            <label for="">name</label>
            <input type="text" name="name" class="form-control" required minlength="4" maxlength="30">
            <label for="">price</label>
            <input type="number" name="price" class="form-control" required min="1" max="100000000">
            <div name="stock_field">
              <label for="">stock</label>
              <input type="number" name="stock" class="form-control" required value="0" min="0" max="1000000">
            </div>
            <label for="">description</label>
            <textarea type="text" name="description" class="form-control"></textarea>
            <label for="">cartegory</label>
            <select name="cartegory" id="" class="form-select">
              <option value="" selected disabled>select cartegory</option>
              {% if cartegories != None %}
              {% for item in cartegories%}
              <option value="{{item}}">{{item}}</option>
              {% endfor%}
              {% endif %}
            </select>
            <label for="">photo</label>
            <input type="file" name="photo" class="form-control" accept=".jpg, .jpeg, .png">
          </div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">cancel</button>
            <button type="submit" class="btn btn-primary">submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <table class="table">
    <thead class="">
      <tr class="bg-light m-2 table-row">
        <th scope="col">#id</th>
        <th scope="col">photo</th>
        <th scope="col">item</th>
        <th scope="col">price</th>
        <th scope="col" name="stock_field">stock</th>
        <th scope="col">cartegory</th>
        <th scope="col">active</th>
        <th scope="col">actions</th>
      </tr>

    </thead>
    <tbody class="table-body">
      {% for item in items%}

      <!-- update item modal for each item -->
      <div class="modal fade" id="itemDialog-{{item.id}}">
        <div class="modal-dialog modal-dialog-centered">
          <div class=" modal-content">
            <div class="modal-header border-0 fw-bold"> Item Card </div>
            <form action="/{{item.type}}/{{item.id}}" method="post" enctype="multipart/form-data">
              <div class="modal-body">
                <label for="">name</label>
                <input type="text" name="name" class="form-control" value="{{item.name}}" required minlength="4"
                  maxlength="30">
                <label for="">price</label>
                <input type="number" name="price" class="form-control" value="{{item.price}}" required min="1"
                  max="100000000">
                {% if item.type=="product" %}
                  <label for="">stock</label>
                  <input type="number" name="stock" class="form-control" value="{{item.stock}}" min="0" max="1000000">
                {% endif %}
                <label for="">description</label>
                <textarea type="text" name="description" class="form-control">{{item.description}}</textarea>
                <label for="" class="text-muted mt-2">is active</label>
                <input type="checkbox" class="m-3" name="active" {% if item.active %} checked="{{item.value}}" {% endif
                  %} id="">
                <br>
                <select name="cartegory" id="" class="form-select">
                  <option value="{{item.cartegory}}" selected disabled>select cartegory</option>
                  {% if cartegories != None %}
                  {% for item in cartegories%}
                   <option value="{{item}}">{{item}}</option>
                  {% endfor%}
                  {% endif %}
                </select>
                <label for="">photo</label>
                <input type="file" name="photo" class="form-control" accept=".jpg, .jpeg, .png" >

              </div>
              <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-dark" data-bs-dismiss="modal">cancel</button>
                <button type="submit" class="btn btn-primary">submit</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- delete item modal for each item -->
      <div class="modal fade" id="deleteDialog-{{item.id}}">
        <div class="modal-dialog modal-sm modal-dialog-centered">
          <div class=" modal-content">
            <div class="modal-header border-0 fw-bold">{{item.name}}</div>
            <div class="modal-body text-muted">are you sure you want to delete this item</div>
            <div class="modal-footer justify-content-between">
              <button class="btn btn-outline-dark rounded-pill" data-bs-dismiss="modal">cancel</button>
              <a href="/delete/{{item.type}}/{{item.id}}" class="btn btn-danger rounded-pill">delete</a>
            </div>
          </div>
        </div>
      </div>

     
      <!-- item row in the table -->
      <tr class="m-2 shadow rounded border-secondary-subtle table-row" >
        <th scope="row"> {{item.id}} </th>
        <td >
          {% if not item.photo %}
          <img  src="{{url_for('static',filename="/images/item.png")}}"
            class="img-fluid rounded-circle bg-primary-subtle" width="50px" alt="" srcset="">
          {% else %}
          <img  src="https://filesapi.biashara.buzz/{{item.photo}}"
             class="img-fluid rounded-circle bg-primary-subtle" width="70px" alt="" srcset="">
          {% endif %}
        </td>
        <td>{{item.name}}</td>
        <td>{{item.price}}</td>
        {% if item.type=="product" %}
        <td>{{item.stock}}</td>
        {% endif %}
        <td>{{item.cartegory}}</td>
        <td>{{item.active}}</td>
        <td class="btn-group" role="group"></a>
          <button class="btn btn-primary" data-bs-target="#itemDialog-{{item.id}}"data-bs-toggle="modal">update</button>
          <button class="btn btn-danger" data-bs-target="#deleteDialog-{{item.id}}" data-bs-toggle="modal">delete</a>
        </td>
      </tr>
      {% endfor %}

    </tbody>
  </table>

  <!-- items mobile view  -->
  <div class="row">
    {% for item in items %}
         <!-- mobile item card -->
        <div class="card table-card m-2 mx-auto p-0">
          {% if not item.photo %}
            <img src="{{url_for('static',filename="/images/item.png")}}" class="card-img-top bg-primary-subtle" style="max-height: 250px;" alt="...">
          {% else %}
           <img src="https://filesapi.biashara.buzz/{{item.photo}}" class="card-img-top bg-primary-subtle" style="max-height: 250px;" alt="...">
          {% endif %}
          <h5 class="card-title m-2 d-flex flex-row justify-content-between"> <span>{{item.name}}</span> <span>#{{item.id}}</span> </h5>

          <div class="card shadow border-secondary-subtle d-flex flex-row p-2 m-2 justify-content-between">
            <div class="text-center me-1">
              <b>price</b> <br>
              <span>{{item.price}}</span>
            </div>
            <div class="text-center me-1">
              <b>stock</b> <br>
              <span>{{item.stock}}</span>
            </div>
            <div class="text-center me-1">
              <b>cartegory</b> <br>
              <span>{{item.cartegory}}</span>
            </div>
            <div class="text-center me-1">
              <b>active</b> <br>
              <span>{{item.active}}</span>
            </div>
          </div>
          <div class="card-footer d-flex justify-content-between">
            <button class="btn btn-primary" data-bs-target="#itemDialog-{{item.id}}" data-bs-toggle="modal">update</button>
            <button class="btn btn-danger" data-bs-target="#deleteDialog-{{item.id}}" data-bs-toggle="modal">delete</button>
          </div>

        </div>

    {% endfor %}
  </div>

</div>

<script>
  const url = window.location.href;
  if (url.includes('service')) {
    const items = document.getElementsByName('stock_field');
    items.forEach(element => {
      element.style.display = 'none'
      element.required = false;
    });
  }
</script>

{% endblock %}